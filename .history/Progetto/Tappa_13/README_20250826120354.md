**Tappa 13 – Magie, Trappole e qualità della vita**

In questa tappa introduciamo le Magie/Trappole (M/T), lo slot dedicato per la Magia Terreno e un po’ di cura all’esperienza di gioco: pescata iniziale “alternata”, animazioni di pescata più chiare per P1 e P2, e un’IA base per il secondo giocatore.

## Cosa include questa tappa
- Zone M/T per entrambi i giocatori (3 slot ciascuno) e slot dedicato per la Magia Terreno.
- Regole minime M/T:
	- Trappole: non si attivano dalla mano; vanno settate; non attivabili nel turno in cui sono state settate; attivabili dal turno successivo (anche nel turno avversario, quando previsto dal timing).
	- Magie Normali/Rituali: attivabili dalla mano; volendo si possono anche settare e attivare subito.
	- Magie Rapide: attivabili dalla mano; se settate non si attivano nello stesso turno; dal turno successivo possono essere attivate anche nel turno avversario (quando il timing lo consente).
	- Magie Continue: restano sul campo dopo l’attivazione.
	- Magie Terreno: usano lo slot dedicato; se ne giochi una nuova, la vecchia va al Cimitero.
- Pescata iniziale alternata P1↔P2 fino a 5 carte ciascuno.
- Animazioni di pescata differenziate: P1 vede la carta al centro (con click per saltare), P2 non rivela e va diretta in mano coperta.
- Fix di rendering lato P2 (retro, rotazioni, zone corrette) e stabilità visiva degli slot Mostro.
- Un’IA semplice per P2 che gioca da sola turni “ragionevoli”.

## Come si gioca (controlli rapidi)
- Dalla mano:
	- M/T: trascina su zona M/T o slot Campo → prompt “A = Attiva, S = Setta”.
		- A: attiva dalla mano (le Field finiscono nello slot Campo; le Trappole non si attivano dalla mano).
		- S: setta coperta. Le Trappole sono sempre settate; le Rapide settate non si attivano nello stesso turno; una Field settata rimpiazza la precedente nello slot Campo.
	- Mostri: trascina su uno slot Mostro → prompt “E = Evoca, P = Posiziona”. Lo slot usato è quello dove lasci la carta.
- Attivare da coperta: premi X con il mouse sopra la tua carta coperta (se le regole lo consentono in quel momento).
- Cambiare posizione Mostro: premi C (flip in ATK quando scopri; ATK↔DEF con le regole di turno).

## Pescata: cosa succede ora
- Apertura alternata: P1, P2, P1, P2, … finché entrambi hanno 5 carte.
	- L’IA del P2 aspetta finché le animazioni di pescata sono concluse (niente salti di fase).
	- Il motore evita doppie pescate di “riempimento” all’inizio del turno.
- Animazioni:
	- P1: la carta appare al centro con la sua immagine frontale per qualche secondo; puoi cliccare per farla andare subito in mano.
	- P2: la carta non si rivela; va direttamente dal mazzo alla mano superiore con la texture di retro.

## Regole M/T in breve
- Trappole: set obbligatorio; non attive nel turno del set; dal turno successivo possono essere attivate anche nel turno avversario (quando il timing lo permette).
- Magie Normali/Rituali: attivabili dalla mano; puoi anche set + attiva subito.
- Magie Rapide: attivabili dalla mano; se settate, non nello stesso turno; dal successivo anche nel turno avversario.
- Magie Continue: restano sul campo dopo l’attivazione.
- Magie Terreno: slot Campo dedicato; la precedente va al Cimitero quando ne giochi una nuova.

## IA del Player 2 (AIController)
Un avversario base che rispetta le regole principali e fa scelte semplici.

Come si comporta per fase:
- Draw/Standby: nessuna azione visibile; si passa oltre.
- Main 1: prova a evocare un mostro di livello ≤ 4 nel primo slot libero; se non riesce, prova ad attivare una Magia dalla mano.
- Battle: attacca con i mostri che non hanno attaccato; bersaglia il mostro avversario con ATK più basso, altrimenti attacco diretto.
- Main 2: setta Field, poi Trappole/Magie Rapide dalla mano.
- End: se non ci sono scarti o attese, chiude il turno.

Note d’integrazione:
- L’IA è aggiornata solo quando non ci sono animazioni di pescata (per non spezzare il ritmo).
- Le regole restano centralizzate nel motore: l’IA “propone”, il `Game` accetta o rifiuta.

## Stabilità e resa grafica
- Slot Mostro stabili: i mostri non “scivolano” più verso sinistra quando altri vengono distrutti. Ogni carta ricorda lo slot visivo in cui è stata messa.
- Lato P2: mano e mazzo sono sempre visibili quando dovrebbero; la mano in alto è ruotata correttamente; le carte coperte usano la texture retro.

## Eventi e flusso turno
- Nuovi eventi per M/T e pescata (`SpellSet`, `TrapSet`, `SpellActivated`, `TrapActivated`, `DrawStart`, `DrawEnd`).
- Il turno avanza in modo prevedibile; le finestre di risposta per attivazioni “nel turno avversario” sono modali (quando aperte, il resto si ferma).
- Condizioni di Game Over: LP a 0 o impossibilità di pescare; appare un overlay con l’esito.

## Come eseguire
Eseguibile: `mainTappa13`.

Se usi CMake Tools in VS Code, seleziona il target `mainTappa13` e lancia. In alternativa, da PowerShell:

```powershell
cmake --build "${env:USERPROFILE}\Documents\Università\TerzoAnno\SecondoSemestre\FCG\Progetto\build" --config Release
"${env:USERPROFILE}\Documents\Università\TerzoAnno\SecondoSemestre\FCG\Progetto\build\bin\mainTappa13.exe"
```

## Prossimi passi
- Migliorare la finestra di risposta (stack/catena, priorità e timing più accurati).
- Overlay di scelta slot anche per Special Summon.
- Aggiungere screenshot/GIF per le due animazioni di pescata e qualche esempio d’uso.

