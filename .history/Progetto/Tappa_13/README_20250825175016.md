**Tappa 13 – Magie e Trappole (engine + build)**

Questa tappa introduce il sistema di Magie/Trappole (M/T): zone dedicate, slot Magia Terreno, regole di set/attivazione, eventi e API del `Game`.

## Obiettivi
- Zone M/T per entrambi i giocatori con 3 slot ciascuna.
- Slot esclusivo per Magia Terreno per ogni giocatore (sostituzione invia la precedente al Cimitero).
- Regole di attivazione conformi al minimo richiesto:
	- Trappole: non si attivano dalla mano; vanno settate; non attivabili nel turno in cui sono state settate; (prossimo step) attivabili nel turno avversario.
	- Magie Normali/Rituali: attivabili dalla mano; possono anche essere settate e attivate subito.
	- Magie Rapide: attivabili dalla mano; se settate non attivabili nello stesso turno; (prossimo step) utilizzabili nel turno avversario.
	- Magie Continue: restano sul campo dopo l’attivazione.
	- Magie Terreno: vanno nello slot dedicato e restano attive.

## Cambi principali al codice

### Game
File: `GameLogic/Game/Game.h` e `GameLogic/Game/Game.cpp`.

- Nuove zone e stato:
	- `spellTraps[2]`: carte M/T sul campo (3 slot per giocatore).
	- `stIsFaceDown[2]`: true se la carta M/T nello slot è coperta.
	- `stSetThisTurn[2]`: true se la carta è stata settata in questo turno del proprietario (vincolo di timing).
	- `fieldSpell[2]`: slot opzionale per Magia Terreno (una per giocatore).
- Nuove API M/T:
	- `bool setSpellOrTrap(size_t handIndex);`
	- `bool setFieldSpell(size_t handIndex);`
	- `bool activateSpellFromHand(size_t handIndex);` (blocca Trappole dalla mano; Continue restano sul campo; Terreno usa slot dedicato)
	- `bool activateSetSpellTrap(size_t zoneIndex);` (blocca attivazione nello stesso turno del set per Trappole e Rapide)
	- Query: `isSpellTrapFaceDownAt`, `isSpellTrapSetThisTurnAt`.
- Integrazione turno/fasi:
	- In `startTurn()` si azzera `stSetThisTurn` per il giocatore corrente, abilitando l’attivazione delle carte settate in turni precedenti.
- `moveCard(...)` esteso a `SpellTrapZone` con mantenimento dei flag e blocco su `FieldSpellZone` (usa API dedicate).

### Eventi
File: `GameLogic/Events/EventDispatcher.h`.

- Aggiunti tipi evento per M/T:
	- `SpellSet`, `TrapSet`, `SpellActivated`, `TrapActivated`.
	- Eventi esistenti riutilizzati: `CardMoved`, `CardSentToGrave`.

### Build
File: `CMakeLists.txt`.

- Aggiunto target `mainTappa13` (simile a Tappa 12). L’eseguibile viene generato in `build/bin/mainTappa13.exe`.

## Stato funzionale (v1)
- Regole coperte:
	- Trappole: set obbligatorio; no attivazione nello stesso turno del set.
	- Magie Normali/Rituali: attivabili dalla mano; set+attivazione immediata consentita.
	- Magie Rapide: dalla mano sì; se settate non attive lo stesso turno.
	- Magie Continue: restano sul campo; vengono messe scoperte nella zona M/T.
	- Magie Terreno: slot dedicato; la precedente viene mandata al Cimitero.
- Da completare (next):
	- Finestra di risposta per permettere l’attivazione nel turno avversario (Trappole e Rapide).
	- UI: drag&drop verso zona M/T e slot Terreno; attivazione da mano/da coperta; resa visiva coperta/scoperta.

## API di riferimento (estratto)
- `bool setSpellOrTrap(size_t handIndex);`
- `bool setFieldSpell(size_t handIndex);`
- `bool activateSpellFromHand(size_t handIndex);`
- `bool activateSetSpellTrap(size_t zoneIndex);`
- `bool isSpellTrapFaceDownAt(int playerIdx, size_t zoneIndex) const;`
- `bool isSpellTrapSetThisTurnAt(int playerIdx, size_t zoneIndex) const;`

## Note UI (da collegare)
- Trascinamento carte dalla mano:
	- In slot M/T: chiama `setSpellOrTrap`.
	- In slot Terreno: chiama `setFieldSpell`.
- Attivazione:
	- Da mano: `activateSpellFromHand` (Trappole bloccate).
	- Da coperta: `activateSetSpellTrap` con controllo dei vincoli.
- Rendering: usare texture retro per `stIsFaceDown==true`, altrimenti texture “front” (`Card::originalTexturePath`).

## Come eseguire
Eseguibile: `mainTappa13`.

Se usi CMake Tools in VS Code: seleziona il target `mainTappa13` e lancia. In alternativa da terminale PowerShell:

```powershell
cmake --build "${env:USERPROFILE}\Documents\Università\TerzoAnno\SecondoSemestre\FCG\Progetto\build" --config Release
"${env:USERPROFILE}\Documents\Università\TerzoAnno\SecondoSemestre\FCG\Progetto\build\bin\mainTappa13.exe"
```

## Prossimi passi
- Implementare la finestra di risposta per attivazioni nel turno avversario.
- Collegare e rifinire la UI M/T in `main.cpp` (drag/attivazione/feedback).
- Documentare esempi d’uso e casi limite nel README con screenshot.

